<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ—è –°–æ—Ü—Å–µ—Ç—å</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>MySocialNet</h1>
        <div>
            <span id="userWelcome"></span>
            <button onclick="logout()" class="btn">–í—ã–π—Ç–∏</button>
        </div>
    </header>

    <div class="container">
        <div class="create-post">
            <textarea id="postText" placeholder="–ß—Ç–æ —É –≤–∞—Å –Ω–æ–≤–æ–≥–æ?"></textarea>
            <button onclick="createPost()" class="btn">–û–ø—É–±–ª–∏–∫–æ–≤–∞—Ç—å</button>
        </div>
        
        <div id="postsContainer">
            <!-- –ü–æ—Å—Ç—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ -->
    <div id="commentsModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeComments()">&times;</span>
            <h3>–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏</h3>
            <div id="commentsList"></div>
            <div class="add-comment">
                <input type="text" id="commentText" placeholder="–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π...">
                <button onclick="addComment()" class="btn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            </div>
        </div>
    </div>

    <script>
        let currentPostId = null;

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
        function checkAuth() {
            const currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }
            document.getElementById('userWelcome').textContent = '–ü—Ä–∏–≤–µ—Ç, ' + currentUser + '!';
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –ø–æ—Å—Ç–æ–≤
        function getPosts() {
            const posts = localStorage.getItem('posts');
            return posts ? JSON.parse(posts) : [];
        }

        function savePost(post) {
            const posts = getPosts();
            posts.unshift(post);
            localStorage.setItem('posts', JSON.stringify(posts));
        }

        function loadPosts() {
            const postsContainer = document.getElementById('postsContainer');
            if (!postsContainer) return;
            
            const posts = getPosts();
            const currentUser = localStorage.getItem('currentUser');
            
            postsContainer.innerHTML = '';
            
            if (posts.length === 0) {
                postsContainer.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>';
                return;
            }
            
            posts.forEach(post => {
                const hasLiked = post.likes && post.likes.includes(currentUser);
                const commentsCount = post.comments ? post.comments.length : 0;
                
                const postElement = document.createElement('div');
                postElement.className = 'post';
                postElement.innerHTML = `
                    <div class="post-header">
                        <strong>üë§ ${post.author}</strong>
                        <span>${new Date(post.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-stats">
                        <span>‚ù§Ô∏è ${post.likes ? post.likes.length : 0} –ª–∞–π–∫–æ–≤</span>
                        <span>üí¨ ${commentsCount} –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤</span>
                    </div>
                    <div class="post-actions">
                        <button onclick="likePost('${post.id}')" class="action-btn ${hasLiked ? 'liked' : ''}">
                            ${hasLiked ? '‚ù§Ô∏è' : 'ü§ç'} –õ–∞–π–∫
                        </button>
                        <button onclick="openComments('${post.id}')" class="action-btn">üí¨ –ö–æ–º–º–µ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å</button>
                    </div>
                `;
                
                postsContainer.appendChild(postElement);
            });
        }

        function createPost() {
            const postText = document.getElementById('postText');
            const currentUser = localStorage.getItem('currentUser');
            
            if (!postText.value.trim()) {
                alert('–ù–∞–ø–∏—à–∏—Ç–µ —á—Ç–æ-–Ω–∏–±—É–¥—å!');
                return;
            }
            
            const newPost = {
                id: Date.now().toString(),
                author: currentUser,
                content: postText.value,
                timestamp: new Date().toISOString(),
                likes: [],
                comments: []
            };
            
            savePost(newPost);
            postText.value = '';
            loadPosts();
        }

        function likePost(postId) {
            const posts = getPosts();
            const post = posts.find(p => p.id === postId);
            const currentUser = localStorage.getItem('currentUser');
            
            if (!post.likes) post.likes = [];
            
            const userIndex = post.likes.indexOf(currentUser);
            
            if (userIndex === -1) {
                post.likes.push(currentUser);
            } else {
                post.likes.splice(userIndex, 1);
            }
            
            const updatedPosts = posts.map(p => p.id === postId ? post : p);
            localStorage.setItem('posts', JSON.stringify(updatedPosts));
            
            loadPosts();
        }

        // –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
        function openComments(postId) {
            currentPostId = postId;
            document.getElementById('commentsModal').style.display = 'block';
            loadComments(postId);
        }

        function closeComments() {
            document.getElementById('commentsModal').style.display = 'none';
            currentPostId = null;
        }

        function loadComments(postId) {
            const posts = getPosts();
            const post = posts.find(p => p.id === postId);
            const commentsList = document.getElementById('commentsList');
            
            commentsList.innerHTML = '';
            
            if (!post.comments || post.comments.length === 0) {
                commentsList.innerHTML = '<p>–ü–æ–∫–∞ –Ω–µ—Ç –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!</p>';
                return;
            }
            
            post.comments.forEach(comment => {
                const commentElement = document.createElement('div');
                commentElement.className = 'comment';
                commentElement.innerHTML = `
                    <div class="comment-header">
                        <strong>${comment.author}</strong>
                        <span>${new Date(comment.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="comment-content">${comment.text}</div>
                `;
                commentsList.appendChild(commentElement);
            });
        }

        function addComment() {
            if (!currentPostId) return;
            
            const commentText = document.getElementById('commentText');
            const text = commentText.value.trim();
            const currentUser = localStorage.getItem('currentUser');
            
            if (!text) {
                alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π!');
                return;
            }
            
            const posts = getPosts();
            const post = posts.find(p => p.id === currentPostId);
            
            if (!post.comments) post.comments = [];
            
            post.comments.push({
                author: currentUser,
                text: text,
                timestamp: new Date().toISOString()
            });
            
            const updatedPosts = posts.map(p => p.id === currentPostId ? post : p);
            localStorage.setItem('posts', JSON.stringify(updatedPosts));
            
            commentText.value = '';
            loadComments(currentPostId);
            loadPosts(); // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤ –≤ –ª–µ–Ω—Ç–µ
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
        window.onclick = function(event) {
            const modal = document.getElementById('commentsModal');
            if (event.target == modal) {
                closeComments();
            }
        }

        // –ó–∞–ø—É—Å–∫–∞–µ–º –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        checkAuth();
        loadPosts();
    </script>
</body>
</html>