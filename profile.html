<!DOCTYPE html>
<html>
<head>
    <title>–ú–æ–π –ü—Ä–æ—Ñ–∏–ª—å - MySocialNet</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <h1>üê¨ MySocialNet</h1>
        <nav>
            <a href="index.html" class="nav-btn">üè† –õ–µ–Ω—Ç–∞</a>
            <a href="profile.html" class="nav-btn active">üë§ –ü—Ä–æ—Ñ–∏–ª—å</a>
            <a href="friends.html" class="nav-btn">üë• –î—Ä—É–∑—å—è</a>
            <a href="messages.html" class="nav-btn">üí¨ –°–æ–æ–±—â–µ–Ω–∏—è</a>
            <span id="userWelcome"></span>
            <button onclick="logout()" class="btn logout-btn">üö™ –í—ã–π—Ç–∏</button>
        </nav>
    </header>

    <div class="container">
        <div class="profile-header">
            <div class="profile-avatar">
                <img src="https://ui-avatars.com/api/?name=User&background=667eea&color=fff&size=120" id="profileAvatar">
                <button onclick="changeAvatar()" class="btn btn-small">üñºÔ∏è –°–º–µ–Ω–∏—Ç—å –∞–≤–∞—Ç–∞—Ä</button>
            </div>
            <div class="profile-info">
                <h2 id="profileUsername"></h2>
                <div class="profile-stats">
                    <div class="stat">
                        <strong id="userPostsCount">0</strong>
                        <span>–ø–æ—Å—Ç–æ–≤</span>
                    </div>
                    <div class="stat">
                        <strong id="userFriendsCount">0</strong>
                        <span>–¥—Ä—É–∑–µ–π</span>
                    </div>
                    <div class="stat">
                        <strong id="userLikesCount">0</strong>
                        <span>–ª–∞–π–∫–æ–≤</span>
                    </div>
                </div>
                <p class="join-date">–ù–∞ —Å–∞–π—Ç–µ —Å <span id="joinDate"></span></p>
            </div>
        </div>

        <div class="profile-tabs">
            <button class="tab-btn active" onclick="openTab('my-posts')">üìù –ú–æ–∏ –ø–æ—Å—Ç—ã</button>
            <button class="tab-btn" onclick="openTab('liked-posts')">‚ù§Ô∏è –ü–æ–Ω—Ä–∞–≤–∏–ª–æ—Å—å</button>
            <button class="tab-btn" onclick="openTab('settings')">‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏</button>
        </div>

        <div id="my-posts" class="tab-content active">
            <h3>–ú–æ–∏ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏</h3>
            <div id="myPostsContainer"></div>
        </div>

        <div id="liked-posts" class="tab-content">
            <h3>–ü–æ–Ω—Ä–∞–≤–∏–≤—à–∏–µ—Å—è –ø–æ—Å—Ç—ã</h3>
            <div id="likedPostsContainer"></div>
        </div>

        <div id="settings" class="tab-content">
            <h3>–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è</h3>
            <div class="settings-form">
                <div class="setting-item">
                    <label>–û —Å–µ–±–µ:</label>
                    <textarea id="userBio" placeholder="–†–∞—Å—Å–∫–∞–∂–∏—Ç–µ –æ —Å–µ–±–µ..."></textarea>
                </div>
                <div class="setting-item">
                    <label>–ì–æ—Ä–æ–¥:</label>
                    <input type="text" id="userCity" placeholder="–í–∞—à –≥–æ—Ä–æ–¥">
                </div>
                <div class="setting-item">
                    <label>–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è:</label>
                    <input type="date" id="userBirthday">
                </div>
                <button onclick="saveProfile()" class="btn">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è</button>
            </div>
            
            <div class="danger-zone">
                <h4>‚ö° –û–ø–∞—Å–Ω–∞—è –∑–æ–Ω–∞</h4>
                <button onclick="changePassword()" class="btn btn-warning">üîê –°–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å</button>
                <button onclick="deleteAccount()" class="btn btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
            </div>
        </div>
    </div>

    <script>
        let currentUser = null;
        let database = { users: [], posts: [], comments: [], friends: [], messages: [] };

        async function loadDatabase() {
            const db = localStorage.getItem('social_network_db');
            database = db ? JSON.parse(db) : { users: [], posts: [], comments: [], friends: [], messages: [] };
        }

        function checkAuth() {
            currentUser = localStorage.getItem('currentUser');
            if (!currentUser) {
                window.location.href = 'login.html';
                return;
            }
            document.getElementById('userWelcome').textContent = currentUser;
            document.getElementById('profileUsername').textContent = currentUser;
            loadProfileData();
        }

        function loadProfileData() {
            const user = database.users.find(u => u.username === currentUser);
            const userPosts = database.posts.filter(p => p.author === currentUser);
            const userLikes = database.posts.filter(p => p.likes && p.likes.includes(currentUser));
            const userFriends = database.friends.filter(f => f.user1 === currentUser || f.user2 === currentUser);
            
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            document.getElementById('userPostsCount').textContent = userPosts.length;
            document.getElementById('userFriendsCount').textContent = userFriends.length;
            document.getElementById('userLikesCount').textContent = userLikes.length;
            
            // –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
            if (user && user.joined) {
                document.getElementById('joinDate').textContent = new Date(user.joined).toLocaleDateString();
            }
            
            // –ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤
            loadMyPosts();
            loadLikedPosts();
            
            // –ù–∞—Å—Ç—Ä–æ–π–∫–∏
            if (user) {
                document.getElementById('userBio').value = user.bio || '';
                document.getElementById('userCity').value = user.city || '';
                document.getElementById('userBirthday').value = user.birthday || '';
            }
        }

        function openTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            event.target.classList.add('active');
        }

        function loadMyPosts() {
            const container = document.getElementById('myPostsContainer');
            const userPosts = database.posts.filter(p => p.author === currentUser)
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = '';
            
            if (userPosts.length === 0) {
                container.innerHTML = '<div class="no-posts">üìù –£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –ø–æ—Å—Ç–æ–≤</div>';
                return;
            }
            
            userPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post';
                postElement.innerHTML = `
                    <div class="post-header">
                        <strong>${post.author}</strong>
                        <span>${new Date(post.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-stats">
                        <span>‚ù§Ô∏è ${post.likes ? post.likes.length : 0}</span>
                        <span>üí¨ ${database.comments.filter(c => c.postId === post.id).length}</span>
                    </div>
                    <button onclick="deletePost(${post.id})" class="btn btn-small btn-danger">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å</button>
                `;
                container.appendChild(postElement);
            });
        }

        function loadLikedPosts() {
            const container = document.getElementById('likedPostsContainer');
            const likedPosts = database.posts.filter(p => p.likes && p.likes.includes(currentUser))
                .sort((a, b) => new Date(b.timestamp) - new Date(a.timestamp));
            
            container.innerHTML = '';
            
            if (likedPosts.length === 0) {
                container.innerHTML = '<div class="no-posts">‚ù§Ô∏è –í—ã –µ—â–µ –Ω–µ –ª–∞–π–∫–∞–ª–∏ –ø–æ—Å—Ç—ã</div>';
                return;
            }
            
            likedPosts.forEach(post => {
                const postElement = document.createElement('div');
                postElement.className = 'post';
                postElement.innerHTML = `
                    <div class="post-header">
                        <strong>${post.author}</strong>
                        <span>${new Date(post.timestamp).toLocaleString()}</span>
                    </div>
                    <div class="post-content">${post.content}</div>
                    <div class="post-stats">
                        <span>‚ù§Ô∏è ${post.likes ? post.likes.length : 0}</span>
                        <span>üí¨ ${database.comments.filter(c => c.postId === post.id).length}</span>
                    </div>
                `;
                container.appendChild(postElement);
            });
        }

        function saveProfile() {
            const userIndex = database.users.findIndex(u => u.username === currentUser);
            if (userIndex === -1) return;
            
            database.users[userIndex] = {
                ...database.users[userIndex],
                bio: document.getElementById('userBio').value,
                city: document.getElementById('userCity').value,
                birthday: document.getElementById('userBirthday').value
            };
            
            localStorage.setItem('social_network_db', JSON.stringify(database));
            alert('‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã!');
        }

        function changeAvatar() {
            alert('üñºÔ∏è –§—É–Ω–∫—Ü–∏—è —Å–º–µ–Ω—ã –∞–≤–∞—Ç–∞—Ä–∞ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞ –≤ —Å–ª–µ–¥—É—é—â–µ–º –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏!');
        }

        function changePassword() {
            const newPassword = prompt('–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å:');
            if (newPassword && newPassword.length >= 4) {
                const userIndex = database.users.findIndex(u => u.username === currentUser);
                if (userIndex !== -1) {
                    database.users[userIndex].password = newPassword;
                    localStorage.setItem('social_network_db', JSON.stringify(database));
                    alert('‚úÖ –ü–∞—Ä–æ–ª—å –∏–∑–º–µ–Ω–µ–Ω!');
                }
            } else {
                alert('–ü–∞—Ä–æ–ª—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—åËá≥Â∞ë 4 —Å–∏–º–≤–æ–ª–∞!');
            }
        }

        function deleteAccount() {
            if (confirm('‚ùå –í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤–∞—à –∞–∫–∫–∞—É–Ω—Ç –∏ –≤—Å–µ –≤–∞—à–∏ –ø–æ—Å—Ç—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                // –£–¥–∞–ª—è–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                database.users = database.users.filter(u => u.username !== currentUser);
                // –£–¥–∞–ª—è–µ–º –ø–æ—Å—Ç—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                database.posts = database.posts.filter(p => p.author !== currentUser);
                // –£–¥–∞–ª—è–µ–º –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                database.comments = database.comments.filter(c => c.author !== currentUser);
                // –£–¥–∞–ª—è–µ–º –∏–∑ –¥—Ä—É–∑–µ–π
                database.friends = database.friends.filter(f => f.user1 !== currentUser && f.user2 !== currentUser);
                // –£–±–∏—Ä–∞–µ–º –ª–∞–π–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
                database.posts.forEach(post => {
                    if (post.likes) {
                        post.likes = post.likes.filter(like => like !== currentUser);
                    }
                });
                
                localStorage.setItem('social_network_db', JSON.stringify(database));
                alert('üëã –ê–∫–∫–∞—É–Ω—Ç —É–¥–∞–ª–µ–Ω!');
                logout();
            }
        }

        function deletePost(postId) {
            if (confirm('–£–¥–∞–ª–∏—Ç—å —ç—Ç–æ—Ç –ø–æ—Å—Ç?')) {
                database.posts = database.posts.filter(p => p.id !== postId);
                database.comments = database.comments.filter(c => c.postId !== postId);
                localStorage.setItem('social_network_db', JSON.stringify(database));
                loadMyPosts();
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            window.location.href = 'login.html';
        }

        async function init() {
            await loadDatabase();
            checkAuth();
        }

        init();
    </script>
</body>
</html>